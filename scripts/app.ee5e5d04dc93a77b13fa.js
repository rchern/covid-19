(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),a(1);const n=a(2),i=a(3),s=a(4);class o{constructor(t){this.mapId=t,this.population={},this.regularShades=["FFFFFF","F2F0F7","DADAEB","BCBDDC","9E9AC8","807DBA","6A51A3","4A1486"],this.growthRateShades=["FFFFFF","31A354","A1D99B","E5F5E0","FFF7BC","FEE0D2","FC9272","DE2D26","333333"],this.max={newDeaths:0,totalDeaths:0,newConfirmed:0,totalConfirmed:0,newDeathsPerCapita:0,totalDeathsPerCapita:0,newConfirmedPerCapita:0,totalConfirmedPerCapita:0,totalConfirmedGrowthToday:0,totalDeathsGrowthToday:0,totalConfirmedGrowthRate:0,totalDeathsGrowthRate:0}}initialize(){$.when(this.fetchData()).done(()=>{this.legends=this.generateLegends(),this.map=new n.default(this.mapId,"totalConfirmed",this.covid19,this.max,this.legends),this.map.styleMap()})}fetchData(){return $.when(this.fetchPopulationData()).then(()=>this.fetchCovid19Data())}fetchPopulationData(){return $.getJSON("./data/population.json").done(t=>{this.population=t})}checkMax(t,e){const a=t[e]||0;a>(this.max[e]||0)&&(this.max[e]=a)}fetchCovid19Data(){return $.getJSON("https://usafactsstatic.blob.core.windows.net/public/2020/coronavirus-timeline/allData.json").done(t=>{const e=t[0].confirmed.length;this.covid19={counties:{},days:[]},t.forEach(t=>{if("00"===t.countyFIPS||t.deaths[e-1]>t.confirmed[e-1])return;const a={county:t.county,stateAbbr:t.stateAbbr,population:this.population[t.countyFIPS]};this.covid19.counties[t.countyFIPS]=a;for(let n=0;n<e;n++){const e=n<=1?0:t.confirmed[n-2],i=n<=1?0:t.deaths[n-2];let s=0===n?0:t.confirmed[n-1],o=0===n?0:t.deaths[n-1];s<e&&(s=e),o<i&&(o=i);let h=t.confirmed[n],r=t.deaths[n];h<s&&(h=s),r<o&&(r=o);const l=h-s,d=r-o,c=s-e,m=o-i,g=0===s?0:Math.floor(l/s*100),u=0===o?0:Math.floor(d/o*100),p=0===e?0:Math.floor(c/e*100),w=0===i?0:Math.floor(m/i*100),f={totalConfirmed:h,totalDeaths:r,newConfirmed:l,newDeaths:d,totalConfirmedGrowthToday:g,totalDeathsGrowthToday:u,totalConfirmedGrowthRate:0===p?0:Math.floor(g/p*100),totalDeathsGrowthRate:0===w?0:Math.floor(u/w*100)};if(this.checkMax(f,"totalConfirmed"),this.checkMax(f,"totalDeaths"),this.checkMax(f,"newConfirmed"),this.checkMax(f,"newDeaths"),null!==a.population){const t=a.population/1e6;f.totalConfirmedPerCapita=Math.floor(f.totalConfirmed/t),f.totalDeathsPerCapita=Math.floor(f.totalDeaths/t),f.newConfirmedPerCapita=Math.floor(f.newConfirmed/t),f.newDeathsPerCapita=Math.floor(f.newDeaths/t),this.checkMax(f,"totalConfirmedPerCapita"),this.checkMax(f,"totalDeathsPerCapita"),this.checkMax(f,"newConfirmedPerCapita"),this.checkMax(f,"newDeathsPerCapita")}null==this.covid19.days[n]&&(this.covid19.days[n]={}),this.covid19.days[n][t.countyFIPS]=f}})})}generateLegends(){return Object.keys(this.max).reduce((t,e)=>{if("totalConfirmedGrowthToday"===e||"totalDeathsGrowthToday"===e)t[e]=new s.Legend([new s.LegendItem(0,this.regularShades[0],0,0,!0),new s.LegendItem(1,this.regularShades[1],1,16,!0),new s.LegendItem(2,this.regularShades[2],17,32,!0),new s.LegendItem(3,this.regularShades[3],33,48,!0),new s.LegendItem(4,this.regularShades[4],49,64,!0),new s.LegendItem(5,this.regularShades[5],65,80,!0),new s.LegendItem(6,this.regularShades[6],81,99,!0),new s.LegendItem(7,this.regularShades[7],100,null,!0)]);else if("totalConfirmedGrowthRate"===e||"totalDeathsGrowthRate"===e)t[e]=new s.Legend([new s.LegendItem(0,this.growthRateShades[0],0,0,!0),new s.LegendItem(1,this.growthRateShades[1],1,33,!0),new s.LegendItem(2,this.growthRateShades[2],34,66,!0),new s.LegendItem(3,this.growthRateShades[3],67,99,!0),new s.LegendItem(4,this.growthRateShades[4],100,100,!0),new s.LegendItem(5,this.growthRateShades[5],101,133,!0),new s.LegendItem(6,this.growthRateShades[6],134,166,!0),new s.LegendItem(7,this.growthRateShades[7],167,199,!0),new s.LegendItem(7,this.growthRateShades[8],200,null,!0)]);else{const a=new i.default(this.regularShades.length,this.max[e]),n=this.regularShades.map((t,e)=>new s.LegendItem(e,t,0===e?0:a.getValue(e-1)+1,a.getValue(e),!0));t[e]=new s.Legend(n)}return t},{})}}window.initMap=function(){const t=new o("map");window.covid19=t,t.initialize()}},function(t,e,a){},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e,a,n,i){this.mapId=t,this.metric=e,this.data=a,this.max=n,this.legends=i,this.currentDayIndex=0,this.animationId=null,this.startDate=new Date(2020,0,22),this.shades=[{code:"F2F0F7",on:!0},{code:"DADAEB",on:!0},{code:"BCBDDC",on:!0},{code:"9E9AC8",on:!0},{code:"807DBA",on:!0},{code:"6A51A3",on:!0},{code:"4A1486",on:!0},{code:"333333",on:!0}],this.currentDayIndex=a.days.length-1,this.map=new google.maps.Map(document.getElementById(this.mapId),{zoom:4,center:{lat:38.95809,lng:-95.26726}}),this.map.data.loadGeoJson("./data/gz_2010_us_050_00_20m.json"),this.infoWindow=new google.maps.InfoWindow,this.map.data.addListener("click",t=>{console.log(t),this.showCountyDetails(t)}),this.handleMetric(),this.handleAnimation(),this.handleToggles(),this.handlePopulation(),this.styleMap()}handlePopulation(){const t=$("#minPopulation");t.on("change",()=>{const e=t.val();this.minPopulation=""===e?void 0:1e3*e,this.styleMap()});const e=$("#maxPopulation");e.on("change",()=>{const t=e.val();this.maxPopulation=""===t?void 0:1e3*t,this.styleMap()})}handleToggles(){$("#legend").on("click",".legend-value",t=>{const e=$(t.currentTarget),a=e.data("position");this.legends[this.metric].toggleItem(a),e.toggleClass("on"),this.styleMap()})}handleAnimation(){const t=t=>{t>=0&&t<=this.data.days.length-1&&(this.currentDayIndex=t,this.styleMap())};$("#rewind-all").on("click",()=>t(0)),$("#rewind-1").on("click",()=>t(this.currentDayIndex-1)),$("#fast-forward-1").on("click",()=>t(this.currentDayIndex+1)),$("#toggle").on("click",()=>{if(null==this.animationId){$("#toggle").removeClass("play").addClass("pause");const e=()=>{this.animationId=setTimeout(()=>{this.currentDayIndex<this.data.days.length-1?(t(this.currentDayIndex+1),e()):$("#toggle").click()},50)};e()}else $("#toggle").removeClass("pause").addClass("play"),clearTimeout(this.animationId),this.animationId=null}),$("#fast-forward-all").on("click",()=>t(this.data.days.length-1))}displayDate(){const t=new Date(this.startDate.getFullYear(),this.startDate.getMonth(),this.startDate.getDate());t.setDate(t.getDate()+this.currentDayIndex),$("#currentDate").text(t.toLocaleDateString("en-US"))}handleMetric(){const t=$("#metric");t.on("change",()=>{this.metric=t.val(),this.styleMap()})}showCountyDetails(t){const e=this.getGeoId(t.feature),a=this.data.days[this.currentDayIndex][e],n=this.data.counties[e],i=`\n<div><b>${n.county}, ${n.stateAbbr}</b></div>\n<div>Population:  ${n.population.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}</div>\n<p>Day ${this.currentDayIndex}</p>\n<p></p>\n<p>\n    New Confirmed: ${a.newConfirmed}\n    <br />\n    ${a.newConfirmedPerCapita} per million\n</p>\n<p>\n    Total Confirmed: ${a.totalConfirmed}\n    <br />\n    ${a.totalConfirmedPerCapita} per million\n    <br />\n    ${a.totalConfirmedGrowthToday}% growth from yesterday\n    <br />\n    ${a.totalConfirmedGrowthRate}% growth change from yesterday\n</p>\n<p></p>\n<p>\n    New Deaths: ${a.newDeaths}\n    <br />\n    ${a.newDeathsPerCapita} per million\n</p>\n<p>\n    Total Deaths: ${a.totalDeaths}\n    <br />\n    ${a.totalDeathsPerCapita} per million\n    <br />\n    ${a.totalDeathsGrowthToday}% growth from yesterday\n    <br />\n    ${a.totalDeathsGrowthRate}% growth change from yesterday\n</p>\n  `;this.infoWindow.setContent(i),this.infoWindow.setPosition(t.latLng),this.infoWindow.setOptions({pixelOffset:new google.maps.Size(0,-34)}),this.infoWindow.open(this.map)}getGeoId(t){return t.getProperty("GEOID")}styleMap(){this.displayDate();const t=this.currentDayIndex;0==t?$("#rewind-1,#rewind-all").addClass("disabled"):$("#rewind-1,#rewind-all").removeClass("disabled"),t==this.data.days.length-1?$("#fast-forward-1,#fast-forward-all,#toggle").addClass("disabled"):$("#fast-forward-1,#fast-forward-all,#toggle").removeClass("disabled"),this.displayLegend(),this.map.data.setStyle(t=>this.styleFeature(t))}styleFeature(t){const e=this.getGeoId(t),a=this.data.days[this.currentDayIndex][e],n=this.data.counties[e];let i="white";if(null!=a){const t=a[this.metric]||0,e=this.legends[this.metric].getPosition(t);e.isOn()&&(null==this.minPopulation||this.minPopulation<=n.population)&&(null==this.maxPopulation||this.maxPopulation>=n.population)&&(i="#"+e.getColor())}return{fillColor:i,strokeWeight:1,strokeColor:"#CCCCCC",fillOpacity:.75}}displayLegend(){const t=this.legends[this.metric];$("#legend").html(t.getHTML())}}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.buckets=t,this.max=e,this.minp=0,this.maxp=t-1,this.minv=0,this.maxv=Math.log(e),this.scale=(this.maxv-this.minv)/(this.maxp-this.minp)}getPosition(t){if(t<=0)return 0;let e=Math.ceil((Math.log(t)-this.minv)/this.scale+this.minp);return 0===e&&t>0&&(e=1),e}getValue(t){let e=Math.round(Math.exp(this.minv+this.scale*(t-this.minp)));return 0===t&&e>0&&(e=0),e}}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.LegendItem=class{constructor(t,e,a,n,i){this.position=t,this.color=e,this.min=a,this.max=n,this.on=i}toggle(){this.on=!this.on}isOn(){return this.on}generateLegend(){let t=`${this.min} to ${this.max}`;return this.min===this.max?t=`${this.min}`:null===this.min?t=`<= ${this.max}`:null===this.max&&(t=`>= ${this.min}`),`\n<div class='col-6 col-sm-3'>\n  <div data-position="${this.position}" class="legend-value ${this.on?"on":""}" style="background-color: #${this.color}">\n    <div>${t}</div>\n  </div>\n</div>\n    `}isInRange(t){return(null===this.min||t>=this.min)&&(null===this.max||t<=this.max)}getColor(){return this.color}};e.Legend=class{constructor(t){this.items=t}toggleItem(t){this.items[t].toggle()}getHTML(){let t="";return t+="<div>",t+="<div class='row align-items-center no-gutters'>",this.items.forEach(e=>t+=e.generateLegend()),t+="</div>",t+="</div>",t}isOn(t){return this.items[t].isOn()}getPosition(t){return this.items.find(e=>e.isInRange(t))}}}],[[0,1]]]);
//# sourceMappingURL=app.ee5e5d04dc93a77b13fa.js.map