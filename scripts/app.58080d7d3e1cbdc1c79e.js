(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),a(1);const n=a(2),o=a(3),i=a(4);class s{constructor(t){this.mapId=t,this.population={},this.regularShades=["FFFFFF","F2F0F7","DADAEB","BCBDDC","9E9AC8","807DBA","6A51A3","4A1486"],this.growthRateShades=["FFFFFF","31A354","A1D99B","E5F5E0","FFF7BC","FEE0D2","FC9272","DE2D26","333333"],this.max={newDeaths:0,totalDeaths:0,newConfirmed:0,totalConfirmed:0,newDeathsPerCapita:0,totalDeathsPerCapita:0,newConfirmedPerCapita:0,totalConfirmedPerCapita:0,totalConfirmedGrowthToday:0,totalDeathsGrowthToday:0,totalConfirmedGrowthRate:0,totalDeathsGrowthRate:0,newDeathsAverage:0,newConfirmedAverage:0,newDeathsPerCapitaAverage:0,newConfirmedPerCapitaAverage:0,totalDeathsGrowthTodayAverage:0,totalConfirmedGrowthTodayAverage:0}}initialize(){$.when(this.fetchData()).done(()=>{this.legends=this.generateLegends(),this.map=new n.default(this.mapId,"totalConfirmed",this.covid19,this.max,this.legends),this.map.styleMap()})}fetchData(){return $.when(this.fetchPopulationData()).then(()=>this.fetchCovid19Data())}fetchPopulationData(){return $.getJSON("./data/population.json").done(t=>{this.population=t})}checkMax(t,e){const a=t[e]||0;a>(this.max[e]||0)&&(this.max[e]=a)}fetchCovid19Data(){return $.getJSON("https://usafactsstatic.blob.core.windows.net/public/2020/coronavirus-timeline/allData.json").done(t=>{const e=t[0].confirmed.length;this.covid19={counties:{},days:[]},t.forEach(t=>{if("00"===t.countyFIPS||t.deaths[e-1]>t.confirmed[e-1])return;const a={county:t.county,stateAbbr:t.stateAbbr,population:this.population[t.countyFIPS]};this.covid19.counties[t.countyFIPS]=a;for(let n=0;n<e;n++){const e=n<=1?0:t.confirmed[n-2],o=n<=1?0:t.deaths[n-2];let i=0===n?0:t.confirmed[n-1],s=0===n?0:t.deaths[n-1];i<e&&(i=e),s<o&&(s=o);let h=t.confirmed[n],r=t.deaths[n];h<i&&(h=i),r<s&&(r=s);const l=h-i,d=r-s,c=i-e,g=s-o,m=0===i?0:Math.floor(l/i*100),w=0===s?0:Math.floor(d/s*100),u=0===e?0:Math.floor(c/e*100),f=0===o?0:Math.floor(g/o*100),p=0===u?0:Math.floor(m/u*100),C=0===f?0:Math.floor(w/f*100),D={totalConfirmed:h,totalDeaths:r,newConfirmed:l,newDeaths:d,totalConfirmedGrowthToday:Math.floor(100*m)/100,totalDeathsGrowthToday:Math.floor(100*w)/100,totalConfirmedGrowthRate:Math.floor(100*p)/100,totalDeathsGrowthRate:Math.floor(100*C)/100};if(this.checkMax(D,"totalConfirmed"),this.checkMax(D,"totalDeaths"),this.checkMax(D,"newConfirmed"),this.checkMax(D,"newDeaths"),null!==a.population){const t=a.population/1e6;D.totalConfirmedPerCapita=Math.floor(D.totalConfirmed/t),D.totalDeathsPerCapita=Math.floor(D.totalDeaths/t),D.newConfirmedPerCapita=Math.floor(D.newConfirmed/t),D.newDeathsPerCapita=Math.floor(D.newDeaths/t),this.checkMax(D,"totalConfirmedPerCapita"),this.checkMax(D,"totalDeathsPerCapita"),this.checkMax(D,"newConfirmedPerCapita"),this.checkMax(D,"newDeathsPerCapita")}null==this.covid19.days[n]&&(this.covid19.days[n]={national:{},data:{}}),this.covid19.days[n].data[t.countyFIPS]=D}}),this.covid19.days.forEach((t,e)=>{t.national=Object.keys(t.data).reduce((a,n)=>{const o=t.data[n];a.totalConfirmed=(a.totalConfirmed||0)+o.totalConfirmed,a.totalDeaths=(a.totalDeaths||0)+o.totalDeaths,a.newConfirmed=(a.newConfirmed||0)+o.newConfirmed,a.newDeaths=(a.newDeaths||0)+o.newDeaths;const i=a.totalConfirmed-a.newConfirmed;a.totalConfirmedGrowthToday=0===i?0:Math.floor(a.newConfirmed/i*100*100)/100;const s=a.totalDeaths-a.newDeaths;a.totalDeathsGrowthToday=0===s?0:Math.floor(a.newDeaths/s*100*100)/100;const h=this.getWindow(e).map(t=>t.data[n]);return o.newConfirmedAverage=Math.floor(h.reduce((t,e)=>t+e.newConfirmed,0)/h.length),o.newDeathsAverage=Math.floor(h.reduce((t,e)=>t+e.newDeaths,0)/h.length),o.totalConfirmedGrowthTodayAverage=Math.floor(h.reduce((t,e)=>t+e.totalConfirmedGrowthToday,0)/h.length),o.totalDeathsGrowthTodayAverage=Math.floor(h.reduce((t,e)=>t+e.totalDeathsGrowthToday,0)/h.length),this.checkMax(o,"newConfirmedAverage"),this.checkMax(o,"newDeathsAverage"),this.checkMax(o,"totalConfirmedGrowthTodayAverage"),this.checkMax(o,"totalDeathsGrowthTodayAverage"),null!==this.covid19.counties[n].population&&(o.newConfirmedPerCapitaAverage=Math.floor(h.reduce((t,e)=>t+e.newConfirmedPerCapita,0)/h.length),o.newDeathsPerCapitaAverage=Math.floor(h.reduce((t,e)=>t+e.newDeathsPerCapita,0)/h.length),this.checkMax(o,"newConfirmedPerCapitaAverage"),this.checkMax(o,"newDeathsPerCapitaAverage")),a},{})}),this.covid19.days.forEach((t,e)=>{if(e>0){const a=this.covid19.days[e-1].national.totalConfirmedGrowthToday;t.national.totalConfirmedGrowthRate=0===a?0:Math.floor(t.national.totalConfirmedGrowthToday/a*100*100)/100;const n=this.covid19.days[e-1].national.totalDeathsGrowthToday;t.national.totalDeathsGrowthRate=0===n?0:Math.floor(t.national.totalDeathsGrowthToday/n*100*100)/100}const a=this.getWindow(e).map(t=>t.national);t.national.newConfirmedAverage=Math.floor(a.reduce((t,e)=>t+e.newConfirmed,0)/a.length),t.national.newDeathsAverage=Math.floor(a.reduce((t,e)=>t+e.newDeaths,0)/a.length),t.national.totalConfirmedGrowthTodayAverage=Math.floor(a.reduce((t,e)=>t+e.totalConfirmedGrowthToday,0)/a.length),t.national.totalDeathsGrowthTodayAverage=Math.floor(a.reduce((t,e)=>t+e.totalDeathsGrowthToday,0)/a.length)})})}getWindow(t){const e=Math.max(0,t-3),a=Math.min(this.covid19.days.length,t+4);return this.covid19.days.slice(e,a)}generateLegends(){return Object.keys(this.max).reduce((t,e)=>{if(e.indexOf("GrowthToday")>0)t[e]=new i.Legend([new i.LegendItem(0,this.regularShades[0],0,0,!0),new i.LegendItem(1,this.regularShades[1],1,16,!0),new i.LegendItem(2,this.regularShades[2],17,32,!0),new i.LegendItem(3,this.regularShades[3],33,48,!0),new i.LegendItem(4,this.regularShades[4],49,64,!0),new i.LegendItem(5,this.regularShades[5],65,80,!0),new i.LegendItem(6,this.regularShades[6],81,99,!0),new i.LegendItem(7,this.regularShades[7],100,null,!0)]);else if(e.indexOf("GrowthRate")>0)t[e]=new i.Legend([new i.LegendItem(0,this.growthRateShades[0],0,0,!0),new i.LegendItem(1,this.growthRateShades[1],1,33,!0),new i.LegendItem(2,this.growthRateShades[2],34,66,!0),new i.LegendItem(3,this.growthRateShades[3],67,99,!0),new i.LegendItem(4,this.growthRateShades[4],100,100,!0),new i.LegendItem(5,this.growthRateShades[5],101,133,!0),new i.LegendItem(6,this.growthRateShades[6],134,166,!0),new i.LegendItem(7,this.growthRateShades[7],167,199,!0),new i.LegendItem(7,this.growthRateShades[8],200,null,!0)]);else{const a=new o.default(this.regularShades.length,this.max[e]),n=this.regularShades.map((t,e)=>new i.LegendItem(e,t,0===e?0:a.getValue(e-1)+1,a.getValue(e),!0));t[e]=new i.Legend(n)}return t},{})}}window.initMap=function(){const t=new s("map");window.covid19=t,t.initialize()}},function(t,e,a){},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e,a,n,o){this.mapId=t,this.metric=e,this.data=a,this.max=n,this.legends=o,this.currentDayIndex=0,this.animationId=null,this.startDate=new Date(2020,0,22),this.shades=[{code:"F2F0F7",on:!0},{code:"DADAEB",on:!0},{code:"BCBDDC",on:!0},{code:"9E9AC8",on:!0},{code:"807DBA",on:!0},{code:"6A51A3",on:!0},{code:"4A1486",on:!0},{code:"333333",on:!0}],this.currentDayIndex=a.days.length-1,this.map=new google.maps.Map(document.getElementById(this.mapId),{zoom:4,center:{lat:38.95809,lng:-95.26726}}),this.map.data.loadGeoJson("./data/gz_2010_us_050_00_20m.json"),this.infoWindow=new google.maps.InfoWindow,this.map.data.addListener("click",t=>{this.showCountyDetails(t)}),this.handleMetric(),this.handleAnimation(),this.handleToggles(),this.handlePopulation(),this.styleMap()}handlePopulation(){const t=$("#minPopulation");t.on("change",()=>{const e=t.val();this.minPopulation=""===e?void 0:1e3*e,this.styleMap()});const e=$("#maxPopulation");e.on("change",()=>{const t=e.val();this.maxPopulation=""===t?void 0:1e3*t,this.styleMap()})}handleToggles(){$("#legend").on("click",".legend-value",t=>{const e=$(t.currentTarget),a=e.data("position");this.legends[this.metric].toggleItem(a),e.toggleClass("on"),this.styleMap()})}handleAnimation(){const t=t=>{t>=0&&t<=this.data.days.length-1&&(this.currentDayIndex=t,this.styleMap())};$("#rewind-all").on("click",()=>t(0)),$("#rewind-1").on("click",()=>t(this.currentDayIndex-1)),$("#fast-forward-1").on("click",()=>t(this.currentDayIndex+1)),$("#toggle").on("click",()=>{if(null==this.animationId){$("#toggle").removeClass("play").addClass("pause");const e=()=>{this.animationId=setTimeout(()=>{this.currentDayIndex<this.data.days.length-1?(t(this.currentDayIndex+1),e()):$("#toggle").click()},50)};e()}else $("#toggle").removeClass("pause").addClass("play"),clearTimeout(this.animationId),this.animationId=null}),$("#fast-forward-all").on("click",()=>t(this.data.days.length-1))}displayDate(){const t=new Date(this.startDate.getFullYear(),this.startDate.getMonth(),this.startDate.getDate());t.setDate(t.getDate()+this.currentDayIndex),$("#currentDate").text(t.toLocaleDateString("en-US"));const e=this.metric.indexOf("Growth")>=0,a=this.data.days[this.currentDayIndex].national[this.metric];null==a?($("#nationValue").text(""),$("#national").hide()):($("#nationalValue").text((e?a:a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))+(this.metric.indexOf("Growth")>=0?"%":"")),$("#national").show())}handleMetric(){const t=$("#metric");t.on("change",()=>{this.metric=t.val(),this.styleMap()})}showCountyDetails(t){const e=this.getGeoId(t.feature),a=this.data.days[this.currentDayIndex].data[e],n=this.data.counties[e],o=`\n<div><b>${n.county}, ${n.stateAbbr}</b></div>\n<div>Population:  ${n.population.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}</div>\n<p>Day ${this.currentDayIndex}</p>\n<p></p>\n<p>\n    New Confirmed: ${a.newConfirmed} (${a.newConfirmedAverage} avg)\n    <br />\n    ${a.newConfirmedPerCapita} per million (${a.newConfirmedPerCapitaAverage} avg)\n</p>\n<p>\n    Total Confirmed: ${a.totalConfirmed}\n    <br />\n    ${a.totalConfirmedPerCapita} per million\n</p>\n<p>\n    Confirmed Growth:\n    ${a.totalConfirmedGrowthToday}% yesterday (${a.totalConfirmedGrowthTodayAverage}% avg)\n    <br />\n    ${a.totalConfirmedGrowthRate}% change from yesterday\n</p>\n<p></p>\n<p>\n    New Deaths: ${a.newDeaths} (${a.newDeathsAverage} avg)\n    <br />\n    ${a.newDeathsPerCapita} per million (${a.newDeathsPerCapitaAverage} avg)\n</p>\n<p>\n    Total Deaths: ${a.totalDeaths}\n    <br />\n    ${a.totalDeathsPerCapita} per million\n</p>\n<p>\n    Deaths Growth:\n    ${a.totalDeathsGrowthToday}% from yesterday (${a.totalDeathsGrowthTodayAverage}% avg)\n    <br />\n    ${a.totalDeathsGrowthRate}% change from yesterday\n</p>\n  `;this.infoWindow.setContent(o),this.infoWindow.setPosition(t.latLng),this.infoWindow.setOptions({pixelOffset:new google.maps.Size(0,-34)}),this.infoWindow.open(this.map)}getGeoId(t){return t.getProperty("GEOID")}styleMap(){this.displayDate();const t=this.currentDayIndex;0==t?$("#rewind-1,#rewind-all").addClass("disabled"):$("#rewind-1,#rewind-all").removeClass("disabled"),t==this.data.days.length-1?$("#fast-forward-1,#fast-forward-all,#toggle").addClass("disabled"):$("#fast-forward-1,#fast-forward-all,#toggle").removeClass("disabled"),this.displayLegend(),this.map.data.setStyle(t=>this.styleFeature(t))}styleFeature(t){const e=this.getGeoId(t),a=this.data.days[this.currentDayIndex].data[e],n=this.data.counties[e];let o="white";if(null!=a){const t=a[this.metric]||0,e=this.legends[this.metric].getPosition(t);e.isOn()&&(null==this.minPopulation||this.minPopulation<=n.population)&&(null==this.maxPopulation||this.maxPopulation>=n.population)&&(o="#"+e.getColor())}return{fillColor:o,strokeWeight:1,strokeColor:"#CCCCCC",fillOpacity:.75}}displayLegend(){const t=this.legends[this.metric];$("#legend").html(t.getHTML())}}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.buckets=t,this.max=e,this.minp=0,this.maxp=t-1,this.minv=0,this.maxv=Math.log(e),this.scale=(this.maxv-this.minv)/(this.maxp-this.minp)}getPosition(t){if(t<=0)return 0;let e=Math.ceil((Math.log(t)-this.minv)/this.scale+this.minp);return 0===e&&t>0&&(e=1),e}getValue(t){let e=Math.round(Math.exp(this.minv+this.scale*(t-this.minp)));return 0===t&&e>0&&(e=0),e}}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.LegendItem=class{constructor(t,e,a,n,o){this.position=t,this.color=e,this.min=a,this.max=n,this.on=o}toggle(){this.on=!this.on}isOn(){return this.on}generateLegend(){let t=`${this.min} to ${this.max}`;return this.min===this.max?t=`${this.min}`:null===this.min?t=`<= ${this.max}`:null===this.max&&(t=`>= ${this.min}`),`\n<div class='col-6 col-sm-3'>\n  <div data-position="${this.position}" class="legend-value ${this.on?"on":""}" style="background-color: #${this.color}">\n    <div>${t}</div>\n  </div>\n</div>\n    `}isInRange(t){return(null===this.min||t>=this.min)&&(null===this.max||t<=this.max)}getColor(){return this.color}};e.Legend=class{constructor(t){this.items=t}toggleItem(t){this.items[t].toggle()}getHTML(){let t="";return t+="<div>",t+="<div class='row align-items-center no-gutters'>",this.items.forEach(e=>t+=e.generateLegend()),t+="</div>",t+="</div>",t}isOn(t){return this.items[t].isOn()}getPosition(t){return this.items.find(e=>e.isInRange(t))}}}],[[0,1]]]);
//# sourceMappingURL=app.58080d7d3e1cbdc1c79e.js.map